<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Settings Page • Fraud Shield
  </title>
  <!-- Poppins Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 CSS -->
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet"/>
  <!-- Font Awesome 6 -->
  <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-DY5kWf4B5Wq+u9bZ2a9dXH3gQq8+bp9+q0Ydhs1l6A0V6Uj5g3LULt6QdK6b7nI0Q4l+2m7mCxy0yB6y0P0Z4g==" referrerpolicy="no-referrer" rel="stylesheet">
   <!-- Global Theme Styles -->
   <link href="style.css" rel="stylesheet">
    <!-- Page specific CSS -->
    <link href="settings_page.css" rel="stylesheet"/>
   </link>
  </link>
 </head>
 <body>
  <!-- Header (common component) -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background:#0000FF;">
   <div class="container-fluid">
    <button aria-controls="appSidebarUser" class="btn btn-outline-light me-2" data-bs-target="#appSidebarUser" data-bs-toggle="offcanvas" type="button">
     <i class="fas fa-bars">
     </i>
    </button>
    <a class="navbar-brand d-flex align-items-center" href="./call_log.html">
     <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/fraudshield/28/28';" src="https://share.google/images/IG0HtHavlhtuhg52t" style="width:28px;height:28px;object-fit:contain;"/>
     Fraud Shield
    </a>
    <div class="d-none d-md-flex flex-grow-1 mx-3">
     <form class="w-100" role="search">
      <div class="input-group">
       <span class="input-group-text bg-white">
        <i class="fas fa-search">
        </i>
       </span>
       <input aria-label="Search" class="form-control" placeholder="Search phone number..." type="search"/>
      </div>
     </form>
    </div>
    <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
     <li class="nav-item me-2">
      <a class="nav-link" data-bs-toggle="tooltip" href="#" title="Notifications">
       <i class="fas fa-bell">
       </i>
      </a>
     </li>
     <li class="nav-item me-2">
      <a class="nav-link" data-bs-toggle="tooltip" href="#" title="Messages">
       <i class="fas fa-envelope">
       </i>
      </a>
     </li>
     <li class="nav-item dropdown">
      <a aria-expanded="false" class="nav-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown" href="#" role="button">
       <span class="me-2">
        User
       </span>
       <img alt="avatar" class="rounded-circle" src="https://picsum.photos/seed/user/28/28"/>
      </a>
      <ul class="dropdown-menu dropdown-menu-end">
       <li>
        <a class="dropdown-item" href="./settings_page.html">
         <i class="fas fa-cog me-2">
         </i>
         Settings
        </a>
       </li>
       <li>
        <a class="dropdown-item" href="./user_profile.html">
         <i class="fas fa-user me-2">
         </i>
         Profile
        </a>
       </li>
       <li>
        <hr class="dropdown-divider"/>
       </li>
       <li>
        <a class="dropdown-item" href="./welcome_screen.html">
         <i class="fas fa-sign-out-alt me-2">
         </i>
         Logout
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </div>
  </nav>
  <div class="app-body d-flex">
   <!-- Sidebar (common component) - offcanvas on small, static on lg+ -->
   <aside aria-labelledby="appSidebarUserLabel" class="offcanvas-lg offcanvas-start d-flex flex-column flex-shrink-0 p-3 bg-dark text-white" id="appSidebarUser" style="width:260px;min-height:100vh;background-color:#000000 !important;" tabindex="-1">
    <div class="offcanvas-header d-lg-none">
     <h5 class="offcanvas-title" id="appSidebarUserLabel">
      Menu
     </h5>
     <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" type="button">
     </button>
    </div>
    <div class="offcanvas-body p-0 d-flex flex-column">
     <div class="d-flex align-items-center mb-3 px-3 pt-3">
      <a class="d-flex align-items-center text-white text-decoration-none" href="./call_log.html">
       <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/fraudshield/32/32';" src="https://share.google/images/IG0HtHavlhtuhg52t" style="width:32px;height:32px;object-fit:contain;"/>
       <span class="fs-5 fw-bold">
        Fraud Shield
       </span>
      </a>
     </div>
     <div class="d-flex align-items-center mb-4 p-2 rounded mx-3" style="background:rgba(255,255,255,0.05);">
      <div class="me-2 rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width:40px;height:40px;background:#2d2d2d;">
       U
      </div>
      <div>
       <div class="fw-semibold">
        User Name
       </div>
       <small class="text-muted">
        End User
       </small>
      </div>
     </div>
     <ul class="nav nav-pills flex-column mb-auto px-2">
      <li class="nav-item">
       <a class="nav-link text-white d-flex align-items-center" href="./call_log.html" style="border-radius:8px;">
        <i class="fas fa-home me-2">
        </i>
        Home / Call Log
       </a>
      </li>
      <li>
       <a class="nav-link text-white d-flex align-items-center" href="./report_form.html" style="border-radius:8px;">
        <i class="fas fa-flag me-2">
        </i>
        Report Number
       </a>
      </li>
      <li>
       <a class="nav-link text-white d-flex align-items-center" href="./protection_history.html" style="border-radius:8px;">
        <i class="fas fa-history me-2">
        </i>
        Protection History
       </a>
      </li>
      <li>
       <a aria-controls="userSettingsMenu" aria-expanded="true" class="nav-link text-white d-flex align-items-center" data-bs-toggle="collapse" href="#userSettingsMenu" role="button" style="border-radius:8px;">
        <i class="fas fa-cog me-2">
        </i>
        Settings
        <i class="fas fa-chevron-down ms-auto">
        </i>
       </a>
       <div class="collapse show" id="userSettingsMenu">
        <ul class="btn-toggle-nav list-unstyled fw-normal small ps-4">
         <li>
          <a class="nav-link text-white-50 d-block py-1" href="./settings_page.html">
           <i class="fas fa-cog me-2">
           </i>
           Settings Hub
          </a>
         </li>
         <li>
          <a class="nav-link text-white-50 d-block py-1" href="./user_profile.html">
           <i class="fas fa-user me-2">
           </i>
           My Profile
          </a>
         </li>
         <li>
          <a class="nav-link text-white-50 d-block py-1" href="./privacy_settings.html">
           <i class="fas fa-shield-alt me-2">
           </i>
           Privacy &amp; Permissions
          </a>
         </li>
        </ul>
       </div>
      </li>
      <li class="mt-2">
       <a class="nav-link text-white-50 d-flex align-items-center" href="./terms_of_service.html" style="border-radius:8px;">
        <i class="fas fa-question-circle me-2">
        </i>
        Terms &amp; Policy
       </a>
      </li>
     </ul>
     <hr class="text-secondary mx-3"/>
     <div class="small text-secondary px-3 pb-3">
      © Fraud Shield
     </div>
     <style>
      #appSidebarUser .nav-link:hover{background:rgba(255,255,255,0.08);} 
          #appSidebarUser .nav-link.active{background:rgba(0,0,255,0.15);border-left:3px solid #0000FF;color:#fff;}
     </style>
    </div>
   </aside>
   <!-- Main content -->
   <main class="flex-fill main-content">
    <div class="container-fluid">
     <!-- Breadcrumb / Page Header -->
     <div class="page-header">
      <div>
       <h1 class="page-title">
        Settings
       </h1>
       <div class="breadcrumb">
        <span class="breadcrumb-item">
         <a href="./call_log.html">
          Home
         </a>
        </span>
        <span aria-current="page" class="breadcrumb-item active">
         Settings
        </span>
       </div>
      </div>
      <div class="reveal-on-hover">
       <button class="btn btn-primary" id="btnSavePrefs">
        <i class="fa-solid fa-floppy-disk me-1">
        </i>
        Save Preferences
       </button>
       <small class="reveal-target text-muted ms-2">
        CTRL+S
       </small>
      </div>
     </div>
     <!-- System feedback/notification area -->
     <div class="alert alert-info d-flex align-items-center" id="systemAlert" role="alert">
      <i class="fa-solid fa-circle-info me-2">
      </i>
      Manage your account and app preferences from this hub.
     </div>
     <div class="row g-4">
      <!-- Settings Navigation -->
      <div class="col-12 col-xl-5">
       <div class="card h-100">
        <div class="card-header">
         <div class="title d-flex align-items-center">
          <span class="widget-title">
           Settings Navigation
          </span>
         </div>
         <div class="d-flex align-items-center gap-2">
          <span class="badge-soft info">
           <i class="fa-solid fa-user-check me-1">
           </i>
           Authenticated
          </span>
         </div>
        </div>
        <div class="card-body">
         <!-- Account Section -->
         <div class="section">
          <div class="section-header mb-2">
           <h6 class="m-0 text-muted text-uppercase">
            Account
           </h6>
          </div>
          <div class="list-group settings-menu mb-3">
           <a class="list-group-item list-group-item-action d-flex align-items-center" data-destination="./user_profile.html" href="#">
            <i class="fa-solid fa-user me-3 text-primary">
            </i>
            <div class="flex-fill">
             <div class="fw-semibold">
              My Profile
             </div>
             <small class="text-muted">
              Edit personal details and preferences
             </small>
            </div>
            <i class="fa-solid fa-chevron-right text-muted">
            </i>
           </a>
           <a class="list-group-item list-group-item-action d-flex align-items-center" data-destination="./privacy_settings.html" href="#">
            <i class="fa-solid fa-shield-halved me-3 text-primary">
            </i>
            <div class="flex-fill">
             <div class="fw-semibold">
              Privacy &amp; Permissions
             </div>
             <small class="text-muted">
              Manage data consents and app permissions
             </small>
            </div>
            <i class="fa-solid fa-chevron-right text-muted">
            </i>
           </a>
           <a class="list-group-item list-group-item-action d-flex align-items-center" data-destination="./protection_history.html" href="#">
            <i class="fa-solid fa-clock-rotate-left me-3 text-primary">
            </i>
            <div class="flex-fill">
             <div class="fw-semibold">
              Protection History
             </div>
             <small class="text-muted">
              View blocked/flagged call activity
             </small>
            </div>
            <i class="fa-solid fa-chevron-right text-muted">
            </i>
           </a>
          </div>
         </div>
         <!-- Information Section -->
         <div class="section">
          <div class="section-header mb-2">
           <h6 class="m-0 text-muted text-uppercase">
            More Info
           </h6>
          </div>
          <div class="list-group settings-menu mb-3">
           <a class="list-group-item list-group-item-action d-flex align-items-center" href="#" id="linkHelp">
            <i class="fa-solid fa-circle-question me-3 text-primary">
            </i>
            <div class="flex-fill">
             <div class="fw-semibold">
              Help &amp; Support
             </div>
             <small class="text-muted">
              Browse FAQs and troubleshooting guides
             </small>
            </div>
            <i class="fa-solid fa-arrow-up-right-from-square text-muted">
            </i>
           </a>
           <a class="list-group-item list-group-item-action d-flex align-items-center" href="./terms_of_service.html">
            <i class="fa-solid fa-file-lines me-3 text-primary">
            </i>
            <div class="flex-fill">
             <div class="fw-semibold">
              Terms of Service
             </div>
             <small class="text-muted">
              Read the latest terms
             </small>
            </div>
            <i class="fa-solid fa-chevron-right text-muted">
            </i>
           </a>
           <a class="list-group-item list-group-item-action d-flex align-items-center" href="#" id="linkPrivacyPolicy">
            <i class="fa-solid fa-file-shield me-3 text-primary">
            </i>
            <div class="flex-fill">
             <div class="fw-semibold">
              Privacy Policy
             </div>
             <small class="text-muted">
              How we handle your data
             </small>
            </div>
            <i class="fa-solid fa-arrow-up-right-from-square text-muted">
            </i>
           </a>
          </div>
         </div>
         <!-- Session Management -->
         <div class="section">
          <div class="section-header mb-2">
           <h6 class="m-0 text-muted text-uppercase">
            Session
           </h6>
          </div>
          <button class="btn btn-danger w-100" id="btnLogout">
           <i class="fa-solid fa-right-from-bracket me-2">
           </i>
           Log Out
          </button>
         </div>
        </div>
       </div>
      </div>
      <!-- Right Column: Recent Protection Activity (example table with sorting/filtering) -->
      <div class="col-12 col-xl-7">
       <div class="card h-100">
        <div class="card-header">
         <div class="title d-flex align-items-center gap-2">
          <span class="widget-title">
           Recent Protection Activity
          </span>
          <span class="badge-soft primary">
           <i class="fa-solid fa-shield-halved me-1">
           </i>
           Preview
          </span>
         </div>
         <div class="d-flex align-items-center gap-2">
          <div class="input-group input-group-sm" style="width:260px;">
           <span class="input-group-text bg-white">
            <i class="fa-solid fa-magnifying-glass">
            </i>
           </span>
           <input class="form-control" id="activityFilter" placeholder="Filter by number or action..." type="search">
           </input>
          </div>
          <button class="btn btn-sm btn-light" id="btnExport">
           <i class="fa-solid fa-file-export me-1">
           </i>
           Export CSV
          </button>
         </div>
        </div>
        <div class="card-body">
         <div class="table-responsive">
          <table class="table table-theme table-hover-reveal align-middle" id="activityTable">
           <thead>
            <tr>
             <th data-sort="date" role="button">
              Date
              <i class="fa-solid fa-sort ms-1 text-muted">
              </i>
             </th>
             <th data-sort="number" role="button">
              Phone Number
              <i class="fa-solid fa-sort ms-1 text-muted">
              </i>
             </th>
             <th data-sort="action" role="button">
              Action
              <i class="fa-solid fa-sort ms-1 text-muted">
              </i>
             </th>
             <th data-sort="outcome" role="button">
              Outcome
              <i class="fa-solid fa-sort ms-1 text-muted">
              </i>
             </th>
             <th class="text-end" data-sort="duration" role="button">
              Duration (s)
              <i class="fa-solid fa-sort ms-1 text-muted">
              </i>
             </th>
            </tr>
           </thead>
           <tbody>
            <!-- Mock data rows -->
            <tr>
             <td data-value="2026-01-22T14:22:00Z">
              22 Jan 2026, 14:22
             </td>
             <td>
              +1 (213) 555-0188
             </td>
             <td>
              <span class="badge-soft warning">
               <i class="fa-solid fa-triangle-exclamation me-1">
               </i>
               Flagged
              </span>
             </td>
             <td>
              Suspected Scam
             </td>
             <td class="text-end" data-value="35">
              35
             </td>
            </tr>
            <tr>
             <td data-value="2026-01-21T09:05:00Z">
              21 Jan 2026, 09:05
             </td>
             <td>
              +1 (415) 555-0123
             </td>
             <td>
              <span class="badge-soft success">
               <i class="fa-solid fa-ban me-1">
               </i>
               Blocked
              </span>
             </td>
             <td>
              Auto-blocked
             </td>
             <td class="text-end" data-value="0">
              0
             </td>
            </tr>
            <tr>
             <td data-value="2026-01-20T18:44:00Z">
              20 Jan 2026, 18:44
             </td>
             <td>
              +44 20 7946 0958
             </td>
             <td>
              <span class="badge-soft info">
               <i class="fa-solid fa-circle-info me-1">
               </i>
               Allowed
              </span>
             </td>
             <td>
              Trusted Contact
             </td>
             <td class="text-end" data-value="182">
              182
             </td>
            </tr>
            <tr>
             <td data-value="2026-01-19T12:30:00Z">
              19 Jan 2026, 12:30
             </td>
             <td>
              +1 (646) 555-0199
             </td>
             <td>
              <span class="badge-soft warning">
               <i class="fa-solid fa-triangle-exclamation me-1">
               </i>
               Flagged
              </span>
             </td>
             <td>
              Reported by Users
             </td>
             <td class="text-end" data-value="12">
              12
             </td>
            </tr>
            <tr>
             <td data-value="2026-01-18T07:12:00Z">
              18 Jan 2026, 07:12
             </td>
             <td>
              +1 (650) 555-0100
             </td>
             <td>
              <span class="badge-soft success">
               <i class="fa-solid fa-ban me-1">
               </i>
               Blocked
              </span>
             </td>
             <td>
              Spam Detected
             </td>
             <td class="text-end" data-value="0">
              0
             </td>
            </tr>
            <tr>
             <td data-value="2026-01-17T22:11:00Z">
              17 Jan 2026, 22:11
             </td>
             <td>
              +61 2 9876 5432
             </td>
             <td>
              <span class="badge-soft info">
               <i class="fa-solid fa-circle-info me-1">
               </i>
               Allowed
              </span>
             </td>
             <td>
              Verified Number
             </td>
             <td class="text-end" data-value="95">
              95
             </td>
            </tr>
           </tbody>
          </table>
         </div>
         <div class="d-flex align-items-center justify-content-between mt-3">
          <small class="text-muted" id="paginationInfo">
           Showing 1–6 of 6 records • Page 1 of 1
          </small>
          <div aria-label="Pagination" class="btn-group btn-group-sm" role="group">
           <button class="btn btn-light" disabled="">
            Prev
           </button>
           <button class="btn btn-light" disabled="">
            Next
           </button>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- Help callouts -->
     <div class="mt-4">
      <div class="alert alert-warning d-flex align-items-center" role="alert">
       <i class="fa-solid fa-hand-point-right me-2">
       </i>
       Tip: Use the left menu to access detailed settings and history pages.
      </div>
     </div>
    </div>
   </main>
  </div>
  <!-- Footer (common component) -->
  <footer class="mt-auto py-3" style="background:#000000;color:#fff;">
   <div class="container-fluid d-flex flex-wrap align-items-center justify-content-between">
    <div class="d-flex align-items-center">
     <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/fraudshield/20/20';" src="https://share.google/images/IG0HtHavlhtuhg52t" style="width:20px;height:20px;object-fit:contain;"/>
     <small>
      © 2026 Fraud Shield
     </small>
    </div>
    <ul class="nav">
     <li class="nav-item">
      <a class="nav-link px-2 text-white-50" href="./terms_of_service.html">
       Terms
      </a>
     </li>
     <li class="nav-item">
      <a class="nav-link px-2 text-white-50" href="./privacy_settings.html">
       Privacy
      </a>
     </li>
     <li class="nav-item">
      <a class="btn btn-sm btn-outline-light ms-2" href="./report_form.html">
       <i class="fas fa-flag me-1">
       </i>
       Report
      </a>
     </li>
    </ul>
   </div>
  </footer>
  <!-- Toasts container -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1060">
   <div aria-atomic="true" aria-live="assertive" class="toast align-items-center text-bg-primary border-0" id="actionToast" role="alert">
    <div class="d-flex">
     <div class="toast-body">
      <i class="fa-solid fa-circle-check me-2">
      </i>
      Preferences saved successfully.
     </div>
     <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" type="button">
     </button>
    </div>
   </div>
  </div>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">
  </script>
  <!-- Bootstrap JS -->
  <script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
  </script>
  <script>
   // Bootstrap tooltips
const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
tooltipTriggerList.map(function(tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
})

// Auth gate (mock)
const isAuthenticated = true; // toggle to simulate auth state
const navItems = document.querySelectorAll('.settings-menu .list-group-item');

if (!isAuthenticated) {
    document.getElementById('systemAlert').classList.remove('alert-info');
    document.getElementById('systemAlert').classList.add('alert-danger');
    document.getElementById('systemAlert').innerHTML = '<i class="fa-solid fa-triangle-exclamation me-2"></i>You must be logged in to access settings.';
    navItems.forEach(a => {
        a.classList.add('disabled');
        a.setAttribute('aria-disabled', 'true');
    });
    document.getElementById('btnLogout').setAttribute('disabled', 'disabled');
}

// Navigation click handlers
navItems.forEach(item => {
    item.addEventListener('click', (e) => {
        e.preventDefault();
        if (item.classList.contains('disabled')) return;
        const dest = item.getAttribute('data-destination');
        if (dest) window.location.href = dest;
    });
});

// Help & Privacy Policy via SweetAlert2
document.getElementById('linkHelp').addEventListener('click', (e) => {
    e.preventDefault();
    Swal.fire({
        title: 'Help & Support',
        html: '<div class="text-start">\
                <p>Find answers to common questions, troubleshooting guides, and best practices.</p>\
                <ul class="mb-2">\
                  <li>How to report a suspicious number</li>\
                  <li>Managing permissions and privacy</li>\
                  <li>Understanding protection history</li>\
                </ul>\
                <p class="mb-0">For detailed docs, visit our Developer Portal.</p>\
              </div>',
        icon: 'info',
        confirmButtonText: 'Open Developer Portal',
        showCancelButton: true,
        cancelButtonText: 'Close',
        confirmButtonColor: '#0000FF'
    }).then(r => {
        if (r.isConfirmed) window.location.href = './developer_portal.html';
    });
});

document.getElementById('linkPrivacyPolicy').addEventListener('click', (e) => {
    e.preventDefault();
    Swal.fire({
        title: 'Privacy Policy',
        html: '<div class="text-start">\
                <p>Your privacy matters. We collect minimal data required to provide protection features.</p>\
                <p>Key points:</p>\
                <ul>\
                  <li>We never sell your data.</li>\
                  <li>Permissions are used only for described features.</li>\
                  <li>You can revoke consents anytime in Privacy & Permissions.</li>\
                </ul>\
                <p class="mb-0">Full policy available from the app store listing or on request.</p>\
              </div>',
        icon: 'info',
        confirmButtonText: 'OK',
        confirmButtonColor: '#0000FF'
    });
});

// Save Preferences action (demo)
const btnSavePrefs = document.getElementById('btnSavePrefs');
const actionToastEl = document.getElementById('actionToast');
const actionToast = bootstrap.Toast.getOrCreateInstance(actionToastEl, {
    delay: 2500
});
btnSavePrefs.addEventListener('click', () => {
    // Simulate save
    setTimeout(() => {
        actionToast.show();
    }, 250);
});

// Logout confirmation
document.getElementById('btnLogout').addEventListener('click', () => {
    Swal.fire({
        title: 'Log out?',
        text: 'You will be logged out of your session.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, log out',
        cancelButtonText: 'Cancel',
        confirmButtonColor: '#d33'
    }).then((result) => {
        if (result.isConfirmed) {
            // Clear session (mock)
            try {
                localStorage.clear();
                sessionStorage.clear();
            } catch (e) {}
            Swal.fire({
                title: 'Logged out',
                text: 'You have been logged out successfully.',
                icon: 'success',
                confirmButtonColor: '#0000FF'
            }).then(() => {
                window.location.href = './welcome_screen.html';
            });
        }
    });
});

// Table filtering and sorting
const table = document.getElementById('activityTable');
const tbody = table.querySelector('tbody');
const filterInput = document.getElementById('activityFilter');
let currentSort = {
    key: 'date',
    dir: 'desc'
};

function getRowData(row) {
    const tds = row.querySelectorAll('td');
    return {
        date: new Date(tds[0].getAttribute('data-value')),
        number: tds[1].textContent.trim(),
        action: tds[2].innerText.trim(),
        outcome: tds[3].textContent.trim(),
        duration: parseInt(tds[4].getAttribute('data-value') || tds[4].textContent.trim(), 10)
    };
}

function applyFilter() {
    const q = filterInput.value.toLowerCase();
    const rows = Array.from(tbody.querySelectorAll('tr'));
    let count = 0;
    rows.forEach(r => {
        const text = r.textContent.toLowerCase();
        const show = text.includes(q);
        r.style.display = show ? '' : 'none';
        if (show) count++;
    });
    document.getElementById('paginationInfo').textContent = `Showing ${count} of ${rows.length} records • Page 1 of 1`;
}

function applySort(key) {
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const dir = (currentSort.key === key && currentSort.dir === 'asc') ? 'desc' : 'asc';
    rows.sort((a, b) => {
        const da = getRowData(a)[key];
        const db = getRowData(b)[key];
        if (da < db) return dir === 'asc' ? -1 : 1;
        if (da > db) return dir === 'asc' ? 1 : -1;
        return 0;
    });
    rows.forEach(r => tbody.appendChild(r));
    currentSort = {
        key,
        dir
    };
}

filterInput.addEventListener('input', applyFilter);

table.querySelectorAll('thead th[role="button"]').forEach(th => {
    th.addEventListener('click', () => {
        applySort(th.getAttribute('data-sort'));
    });
});

// Export CSV (simple)
document.getElementById('btnExport').addEventListener('click', () => {
    const rows = Array.from(tbody.querySelectorAll('tr')).filter(r => r.style.display !== 'none');
    let csv = 'Date,Phone Number,Action,Outcome,Duration (s)\n';
    rows.forEach(r => {
        const cols = Array.from(r.querySelectorAll('td'));
        csv += '"' + cols[0].textContent.trim() + '",' +
            '"' + cols[1].textContent.trim() + '",' +
            '"' + cols[2].innerText.trim() + '",' +
            '"' + cols[3].textContent.trim() + '",' +
            cols[4].textContent.trim() + '\n';
    });
    const blob = new Blob([csv], {
        type: 'text/csv;charset=utf-8;'
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'protection_activity.csv';
    a.click();
    URL.revokeObjectURL(url);
});

// Initial filter & sort state
applySort('date');
applyFilter();
  </script>
 </body>
</html>
